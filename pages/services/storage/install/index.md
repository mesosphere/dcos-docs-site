---
layout: layout.pug
navigationTitle: Install
title: Install
menuWeight: 15
excerpt:
---

# [Install](#Install)

## [Prerequisites](#Prerequisites)
## [Build the local universe and artifacts server](#Build-the-local-universe-and-artifacts-server)
## [Launch the local universe and artifacts server](#Launch-the-local-universe-and-artifacts-server)
## [Add the local universe](#Add-the-local-universe)
## [Install the DSS package](#Install-the-DSS-package)
## [Verify that the DSS is running](#Verify-that-the-DSS-is-running)

# [Install]

## Prerequisites

* DC/OS Enterprise 1.11 or above.
* Storage feature flag is turned on (`feature_dcos_storage_enabled: true` in config.yaml).
* DC/OS <a href="https://docs.mesosphere.com/1.10/cli/install//">CLI</a> is installed and has been logged in as a superuser.

## Build the local universe and artifacts server

Extract DC/OS Storage Service (DSS) package tarball. Make sure to name the tarball `package.tgz` and DO NOT delete it after extraction.

```bash
$ tar zxvf package.tgz
$ cd package
```

Build the Docker image that will serve both the local universe as well as the artifacts used by DC/OS storage service. Specify the `DOCKER_IMAGE` environment variable accordingly so that the image can be pushed to docker hub or your local docker registry. DO NOT specify the tag of the Docker image because it will be generated by the build script according to the version of the DSS package.

```bash
$ DOCKER_IMAGE=user/storage-artifacts universe/build.sh
```

The build script will generate some instructions for the next steps as seen below. Notice that the `<SHA>` will be replaced with a real SHA1 value, reflecting the version of the DSS package. 

  **Note:** Do not change the SHA1 value when following the instructions.

**Next Steps:**
<ol>
  <li>Push the docker image 'user/storage-artifacts:<SHA>'<br>
    :; docker push user/storage-artifacts:<SHA> </li>
  <li>Run the following marathon app in your cluster<br>
      :; dcos marathon app add /dev/stdin <<EOF
  </li>

```json
{
  "id": "/storage-artifacts/<SHA>",
  "instances": 1,
  "cpus": 0.25,
  "mem": 128,
  "container": {
    "type": "MESOS",
    "docker": {
      "image": "user/storage-artifacts:<SHA>",
      "forcePullImage": true
    },
    "portMappings": [
      {
        "containerPort": 80,
        "labels": {
          "VIP_0": "/storage-artifacts/<SHA>:10000"
        },
        "protocol": "tcp"
      }
    ]
  },
  "networks": [
    {
      "mode": "container/bridge"
    }
  ]
}
EOF
```

<li>Add the custom package repository
:; dcos package repo add storage-artifacts-<SHA> http://storage-artifacts<SHA>.marathon.l4lb.thisdcos.directory:10000/repo.json --index=0
</li>
<li> Install the package
:; dcos package install storage --package-version=<VERSION>
</li>

Follow the instructions and push the docker image just built to a docker registry that is accessible in the cluster.

```bash
$ docker push user/storage-artifacts:<SHA>
```

## Launch the local universe and artifacts server

Once the docker image has been pushed to the docker registry successfully, use the marathon config to launch a Marathon app that will serve the local universe and the storage artifacts.

```bash
$ cat <<EOF | dcos marathon app add /dev/stdin
```
```json
{
  "id": "/storage-artifacts/<SHA>",
  "instances": 1,
  "cpus": 0.25,
  "mem": 128,
  "container": {
    "type": "MESOS",
    "docker": {
      "image": "jieyu/storage-artifacts:<SHA>",
      "forcePullImage": true
    },
    "portMappings": [
      {
        "containerPort": 80,
        "labels": {
          "VIP_0": "/storage-artifacts/<SHA>:10000"
        },
        "protocol": "tcp"
      }
    ]
  },
  "networks": [
    {
      "mode": "container/bridge"
    }
  ]
}
EOF
```

## Add the local universe

Wait for the Marathon app to be in “Running” state, and then add the local universe for the DSS package.

```bash
$ dcos package repo add storage-artifacts-<SHA> http://storage-artifacts<SHA>.marathon.l4lb.thisdcos.directory:10000/repo.json --index=0
```

## Install the DSS package

Once the above step is successful, install the DSS package by using the following command. This command will install the DC/OS storage subcommand as well.

```bash
$ dcos package install storage --package-version=<VERSION>
```

## Verify that the DSS is running

Run the following command and wait for the DSS to be ready.

```bash
$ dcos storage version
```