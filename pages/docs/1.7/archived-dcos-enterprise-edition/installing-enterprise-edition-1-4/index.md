---
layout: layout.pug
title: Installing Enterprise Edition (1.4)
menuWeight: 0
excerpt: ""
featureMaturity: ""
enterprise: 'yes'
navigationTitle:  Installing Enterprise Edition (1.4)
---







<!-- 1.4 --> You can install DC/OS in your environment by using a customized Bash install script.

The DC/OS installation creates these folders:

*   `/opt/mesosphere`
    :   Contains all the DC/OS binaries, libraries, cluster configuration. Do not modify.

*   `/etc/systemd/system/dcos.target.wants`
    :   Contains the systemd services which start the things that make up systemd. They must live outside of `/opt/mesosphere` because of systemd constraints.

*   Various units prefixed with `dcos` in `/etc/systemd/system`
    :   Copies of the units in `/etc/systemd/system/dcos.target.wants`. They must be at the top folder as well as inside `dcos.target.wants`.

DC/OS is installed in your environment by using a dynamically generated setup file. This file is generated by using specific parameters that are set during installation. This installation file contains a Bash install script and a Docker container that is loaded with everything you need to create a customized DC/OS build.

Contact your sales representative or <sales@mesosphere.io> to obtain the DC/OS setup file.

# Workstation prerequisites

Before installing DC/OS you must prepare your workstation environment.

*   **Docker** Docker version 1.6 or greater must be installed on your workstation. If you are using RHEL7, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.
*   **NGINX Docker image** The Docker NGINX image must be on your workstation. You can use this command to install the NGINX container:
    
         docker pull nginx
        
    
    For more information, see <a href="https://hub.docker.com/_/nginx/" target="_blank">DockerHub nginx</a> documentation.

*   **Zookeeper for shared storage** Shared storage is required by DC/OS during installation and runtime for bootstrapping and managing the internal DC/OS Zookeeper cluster. The Zookeeper for shared storage instance is used only for bootstrapping the DC/OS Exhibitor instance.
    
    Exhibitor automatically configures your Zookeeper installation on the master nodes during your DC/OS installation. This Zookeeper instance should be separate from your cluster. Consider using a separate directory path for the DC/OS cluster so that it does not interfere with other services that use the Zookeeper instance.
    
    Temporary outages while the cluster is running are acceptable, but shared storage should generally be up and running to support replacing failed masters.
    
    **Tip:** To start a Zookeeper instance using Docker, run this command:
    
         docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name=dcos_int_zk jplock/zookeeper
        
    
    <!-- Amazon S3 bucket
: This must be a preexisting S3 bucket. -->
    
    <!-- Shared file system
: An Network File System (NFS) mount that Exhibitor can write to. -->

# Cluster prerequisites

Before installing DC/OS you must prepare your cluster environment.

*   **Data compression** You must have the <a href="http://www.info-zip.org/UnZip.html" target="_blank">UnZip</a>, <a href="https://www.gnu.org/software/tar/" target="_blank">GNU tar</a>, and <a href="http://tukaani.org/xz/" target="_blank">XZ Utils</a> data compression utilities installed on your cluster nodes.
    
    To install these utilities on CentOS7 and RHEL7:
    
         yum install -y tar xz unzip curl
        

*   **Docker** Docker version 1.6 or greater must be installed on your cluster nodes. You must run Docker commands as the root user (`sudo`). For more information, see [Docker installation][1].
    
    *   You can install Docker by using this command:
        
             curl -sSL https://get.docker.com | sh
            
        
        If you are using CentOS7 and behind a firewall, you can install docker with this command:
        
             yum install -y docker
            
    
    *   You must enable the Docker service:
        
             sudo systemctl enable docker
            
    
    *   If you are using Docker as a non-root user, you must add your user to the "docker" group:
        
             sudo usermod -aG docker <user>
            
    
    *   You can test that your Docker build is properly installed with these commands:
        
             sudo service docker start 
             sudo docker ps
            
    
    *   If you are using RHEL7, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.

*   **Linux distribution** A supported Linux distribution must be installed on your cluster:
    
    *   Enterprise Linux 7 (RedHat, CentOS)
    *   CoreOS

*   **Nodes**
    
    *   A cluster of 8 or more machines with a supported Linux distribution. The recommended capacity for each node is 16 GB RAM/2 Cores and 16 GB disk space. The minimum size of a node is a machine with 10 GB of disk space and 1 GB of RAM.
    *   All of the nodes in your cluster must be able to send and receive traffic to each other.
    *   IPv6 must be disabled for all nodes. For more information see <a href="https://wiki.centos.org/FAQ/CentOS7#head-8984faf811faccca74c7bcdd74de7467f2fcd8ee" target="_blank">How do I disable IPv6</a>.

*   **Port configuration**
    
    *   ICMP must be enabled between the master and the agent nodes.
    *   TCP and UDP enabled port 53 for DNS.
    *   These ports must be open for communication to the master nodes. 
        *   TCP port 5050 for Mesos masters
        *   TCP port 8080 for Marathon
        *   TCP port 2181 for Zookeeper, see the <a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#sc_zkCommands" target="_blank">ZK Admin Guide</a>
        *   TCP ports 8181, 2888, and 3888 for Exhibitor, see the <a href="https://github.com/Netflix/exhibitor/wiki/REST-Introduction" target="_blank">Exhibitor REST Documentation</a>
    *   These ports must be open for communication to the agent nodes from the master nodes: 
        *   TCP port 5051 for Mesos agent communication.

*   **System updates** Make sure you've updated your system to the latest version.
    
    *   On CentOS7 and RHEL7, you can use this command to update your system:
        
             yum upgrade -y
            

# <a name="config-cluster"></a>Step 1: Prepare your cluster

In this step you prepare your cluster for DC/OS installation.

1.  On each of your master and agent nodes, disable SELinux or set it to permissive mode. This enables DC/OS services and Docker to function properly.
    
        sudo sed -i s/SELINUX=enforcing/SELINUX=permissive/g /etc/selinux/config
        
    
    **Tip:** You can verify the status of SELinux with the `sestatus`command.

2.  Add `nogroup` to each of your Mesos masters and agents.
    
        sudo groupadd nogroup
        

3.  Reboot your cluster for the changes to take affect:
    
        sudo reboot
        

# <a name="create-script"></a>Step 2: Create a script for IP address discovery

In this step you create an IP detect script that runs on each node in the cluster and outputs the node's local IP address. This IP is used to communicate with the other nodes in the cluster. For nodes with multiple IPs, make sure the script outputs the correct one. Each node in a DC/OS cluster has a unique IP address that is used to communicate between nodes in the cluster. The IP detect script prints the unique IPv4 address of a node to STDOUT each time DC/OS is started on the node.

**Important:** The IP address of a node must not change after DC/OS is installed on the node. For example, the IP address must not change when a node is rebooted or if the DHCP lease is renewed. If the IP address of a node does change, the node must be [wiped and reinstalled][2].

To create a script for IP address discovery:

1.  Create a directory named `dcos/genconf` on your workstation.

2.  Create an IP detection script for your environment and save as `genconf/ip-detect`.

## Examples

*   #### Query an authority
    
    Here is another example using the AWS Metadata service to get the IP address:
    
        #!/bin/sh
        # Example ip-detect script using an external authority
        # Uses the AWS Metadata Service to get the node's internal
        # ipv4 address
        curl -fsSL http://169.254.169.254/latest/meta-data/local-ipv4
        

*   #### Use the IP address of an existing interface
    
    This method discovers the IP address of a particular interface of the node.
    
    If you have multiple generations of hardware with different internals, the interface names can change between hosts. The IP detection script must account for the interface name changes. The example script could also be confused if you attach multiple IP addresses to a single interface, or do complex Linux networking, etc.
    
        #!/usr/bin/env bash
        set -o nounset -o errexit
        export PATH=/usr/sbin:/usr/bin:$PATH
        echo $(ip addr show eth0 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1)
        

*   #### Use the network route to the Mesos master
    
    This method uses the route to a Mesos master to find the source IP address to then communicate with that node.
    
    In this example, we assume that the Mesos master has an IP address of `172.28.128.3`. You can use any language for this script. Your Shebang line must be pointed at the correct environment for the language used and the output must be the correct IP address.
    
        #!/usr/bin/env bash
        set -o nounset -o errexit
        
        MASTER_IP=172.28.128.3
        
        echo $(/usr/sbin/ip route show to match 172.28.128.3 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | tail -1)
        

# <a name="config-json"></a>Step 3: Configure your cluster

In this step you create a JSON configuration file that is customized for your environment. DC/OS uses this configuration file during installation to generate your cluster installation files. This step assumes that you are using Zookeeper for shared storage.

1.  Customize this `config.json` template file for your environment.
    
        {
           "bootstrap_url":"http://<workstation_ip>:<your_port>",
           "cluster_name": "<cluster-name>",
           "exhibitor_storage_backend": "zookeeper",
           "exhibitor_zk_hosts": "<host1>:<port1>",
           "exhibitor_zk_path": "/dcos",
           "master_discovery":"static",
           "master_list": "["<master-ip-1>","<master-ip-2>","<master-ip-3>"]",
           "resolvers": "["<dns-resolver-1>"]"
        }
        

2.  Specify these parameters for your environment.
    
    **bootstrap_url** Specify the path to the customized DC/OS build files, where `<workstation_ip>` is your workstation IP address and `<your_port>` is an accessible port other than port 80. All of the nodes that you want to connect to must be able to access the `<workstation_ip>`. The DC/OS installer uses this path to locate the DC/OS build files.
    
    **<a name="cluster-name"></a>cluster_name** Specify the name of your cluster.
    
    **exhibitor_zk_hosts** Specify a comma-separated list of one or more Zookeeper node IP addresses to use for configuring the internal Exhibitor instances. Exhibitor uses this Zookeeper cluster to orchestrate it's configuration.
    
    **master_list** Specify a JSON-formatted list of your static master IP addresses. This must be specified in JSON list format. You must include the escape characters (``) as shown in the template.
    
    **<a name="resolvers"></a>resolvers** Specify a JSON-formatted list of DNS servers for your DC/OS host nodes. You must include the escape characters (``) as shown in the template. Set this parameter to the most authoritative nameservers that you have. If you want to resolve internal hostnames, set it to a nameserver that can resolve them.
    
    *Caution:* If you set the `resolvers` parameter incorrectly, you will permanently damage your configuration and have to reinstall DCOS.

3.  Save as `genconf/config.json`.

For more examples and advanced options, see the [JSON config file options][3].

# <a name="install-bash"></a>Step 4: Configure and install DCOS

In this step you create a custom DC/OS build file on your workstation and then install DC/OS onto your cluster.

**Tip:** If something goes wrong and you need to rerun your setup, use these cluster [cleanup instructions][2].

<!-- Early access URL: https://downloads.dcos.io/dcos/EarlyAccess/dcos_generate_config.sh -->

<!-- Stable URL: https://downloads.dcos.io/dcos/stable/dcos_generate_config.sh -->

1.  Download and save the DC/OS setup file, `dcos_generate_config.sh`, to the `dcos` directory on your workstation. This file is used to create your customized DC/OS build file.
    
    **Important:** Contact your sales representative or <sales@mesosphere.io> to obtain the DC/OS setup file.

2.  From the `dcos` directory, run `dcos_generate_config.sh` on your bootstrapping master nodes to generate a customized DC/OS build. The setup script starts a Docker container that uses the generic DC/OS install files to create customized DC/OS build files for your cluster. The build files are output to `./genconf/serve/`.
    
        sudo bash dcos_generate_config.sh
        
    
    **Tip:** For the install script to work, you must have created [genconf/config.json][4] and [genconf/ip-detect][5].
    
    1.  From the `dcos` directory, run this command to host the DC/OS install package through an NGINX Docker container. For `<your-port>`, specify the port value that is used in the [bootstrap_url][4].
        
            docker run -d -p <your-port>:80 -v $PWD/genconf/serve:/usr/share/nginx/html:ro nginx
            

3.  Run these commands on each of your master nodes to install DC/OS using your custom build file.
    
    1.  SSH to your node:
        
            ssh <master-ip>
            
    
    2.  Make a new directory and navigate to it:
        
            mkdir /tmp/dcos && cd /tmp/dcos
            
    
    3.  Download the DC/OS installer from the NGINX Docker container, where `<workstation-ip>` and `<your_port>` are specified in [bootstrap_url][4]:
        
            curl -O http://<workstation-ip>:<your_port>/dcos_install.sh
            
    
    4.  Run this command to install DC/OS on your master node:
        
            sudo bash dcos_install.sh master
            
    
    **Tip:** Run these commands on your master nodes in succession. Although there is no actual harm to your cluster, DC/OS may issue error messages until all of your master nodes are configured.

4.  Run these commands on each of your agent nodes to install DC/OS using your custom build file.
    
    1.  SSH to your node:
        
            ssh <master-ip>
            
    
    2.  Make a new directory and navigate to it:
        
            mkdir /tmp/dcos && cd /tmp/dcos
            
    
    3.  Download the DC/OS installer from the NGINX Docker container, where `<workstation-ip>` and `<your_port>` are specified in [bootstrap_url][4]:
        
            curl http://<workstation-ip>:<your_port>/dcos_install.sh
            
    
    4.  Run this command to install DC/OS on your agent node:
        
            sudo bash dcos_install.sh slave
            

5.  Monitor Exhibitor and wait for your masters to converge at `http://< master-ip >:8181/exhibitor/v1/ui/index.html`.
    
    **Tip:** This process can take about 10 minutes. During this time you will see the Master nodes become visible on the Exhibitor consoles and come online, eventually showing a green light.
    
    <a href="/wp-content/uploads/2015/12/chef-zk-status.png" rel="attachment wp-att-2112"><img src="/wp-content/uploads/2015/12/chef-zk-status.png" alt="chef-zk-status" width="551" height="467" class="alignnone size-full wp-image-2112" /></a>
    
    When the status icons are green, you can access the DC/OS web interface.

6.  Launch the DC/OS web interface at: http://`<load-balanced-ip>`/:
    
    <a href="/wp-content/uploads/2015/12/dashboardsmall.png" rel="attachment wp-att-1120"><img src="/wp-content/uploads/2015/12/dashboardsmall-800x495.png" alt="dashboardsmall" width="800" height="495" class="alignnone size-large wp-image-1120" /></a>

 [1]: http://docs.docker.com/engine/installation/
 [2]: /1.7/administration/installing/custom/uninstall/
 [3]: /archived-dcos-enterprise-edition/installing-enterprise-edition-1-4/configuration-parameters-1-4/
 [4]: #config-json
 [5]: #create-script