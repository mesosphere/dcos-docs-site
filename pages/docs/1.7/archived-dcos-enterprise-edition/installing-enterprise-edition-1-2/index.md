---
layout: layout.pug
title: Installing Enterprise Edition (1.2)
menuWeight: 0
excerpt:
featureMaturity:
enterprise: true
navigationTitle:  Installing Enterprise Edition (1.2)
---







This topic provides instructions for installing <span class="caps">DC/OS</span> in your environment by using a customized Bash install script.

The <span class="caps">DC/OS</span> installation creates these folders:

*   `/opt/mesosphere`
    :   Contains all the <span class="caps">DC/OS</span> binaries, libraries, cluster configuration. Do not modify.

*   `/etc/systemd/system/dcos.target.wants`
    :   Contains the systemd services which start the things that make up systemd. They must live outside of `/opt/mesosphere` because of systemd constraints.

*   Various units prefixed with `dcos` in `/etc/systemd/system`
    :   Copies of the units in `/etc/systemd/system/dcos.target.wants`. They must be at the top folder as well as inside `dcos.target.wants`.

The <span class="caps">DCOS</span> Enterprise Edition is installed in your environment by using a dynamically generated setup file. This file is generated by using specific parameters that are set during installation. This installation file contains a Bash install script and a Docker container that is loaded with everything you need to create a customized <span class="caps">DCOS</span> build.

# Prerequisites

Contact your sales representative or <sales@mesosphere.io> to obtain the DC/OS setup file.

### <a name="prerequisites"></a>Cluster prerequisites {#a-nameprerequisitesacluster-prerequisites}

Before installing <span class="caps">DCOS</span> you must prepare your cluster environment.

*   **Cluster** A cluster of 8 or more machines with a supported Linux distribution. The recommended capacity for each node is 16 <span class="caps">GB</span> <span class="caps">RAM</span>/2 Cores and 16 <span class="caps">GB</span> disk space. 
*   **Linux distribution** A supported Linux distribution must be installed on your cluster: 
    *   Enterprise Linux 7 (RedHat, Cent<span class="caps">OS</span>) 
    *   Core<span class="caps">OS</span> 
*   **Connected nodes** All of the nodes in your cluster must be able to send and receive traffic to each other. 
*   **Docker** Docker version <span class="caps">1.6</span> or greater must be installed on your cluster nodes. You must run Docker commands as the root user (`sudo`). It is recommended that you install Docker by using this command:
    
        curl -sSL https://get.docker.com | sh
        
    
    If you are running in userspace, you must add `usermod -aG docker <username>` to your command, where `<username>` is the user building the <span class="caps">DCOS</span> packages.
    
    You can test that your Docker build is properly installed with these commands:
    
        sudo service docker start
        sudo docker ps
        
    
    If you are using <span class="caps">RHEL7</span>, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.

*   **Load balancer** *For <span class="caps">DCOS</span> <span class="caps">1.2</span> and earlier:* A high-availability (<span class="caps">HA</span>) load balancer is used to balance these <span class="caps">TCP</span> ports on your master nodes: 80, 443, 8080, 8181, 2181, 5050

*   **Open Ports** These ports must be open for all master nodes:
    
    *   5050 for Mesos masters 
    *   5051 for Mesos agent nodes 
    *   8080 for Marathon 
    *   2181 for Zookeeper, see the <a href="http://zookeeper.apache.org/doc/r3.1.2/zookeeperAdmin.html#sc_zkCommands" target="_blank"><span class="caps">ZK</span> Admin Guide</a> 
    *   8181, 2888, and 3888 for Exhibitor, see the <a href="https://github.com/Netflix/exhibitor/wiki/REST-Introduction" target="_blank">Exhibitor <span class="caps">REST</span> Documentation</a> 

*   **Shared storage** During <span class="caps">DCOS</span> installation, a storage system is required for configuring and orchestrating Zookeeper with Exhibitor on the master nodes. Exhibitor automatically configures your Zookeeper installation on the master nodes during your <span class="caps">DCOS</span> installation. You can use either:
    
    *   **Zookeeper instance**  
        **Tip:** To start a Zookeeper instance on the current host using Docker, run this command:
        
            docker run -d -p 2181:2181 -p 2888:2888 -p 3888:3888 --name=dcos_int_zk jplock/zookeeper`
            
    
    *   **Amazon <span class="caps">S3</span> bucket**
    
    *   **Shared file system, such as <span class="caps">NFS</span>**

**Tip:** If you’d like to clean up your cluster to install a new version or configuration instead of creating an entirely new cluster, follow these [cleanup instructions][1].

* * *

# <a name="config-cluster"></a>Step 1: Prepare your cluster {#a-nameconfig-clusterastep-1-prepare-your-cluster}

In this step you prepare your cluster for <span class="caps">DCOS</span> installation.

1.  On each of your master and agent nodes, disable SELinux or set it to permissive mode. This enables <span class="caps">DCOS</span> services and Docker to function properly.
    
        sudo sed -i s/SELINUX=enforcing/SELINUX=permissive/g /etc/selinux/config
        
    
    **Tip:** You can verify the status of SELinux with the `sestatus`command.

2.  Add `nogroup` to each of your Mesos masters and agents.
    
        sudo groupadd nogroup
        

3.  Reboot your cluster for the changes to take affect:
    
        sudo reboot
        

* * *

# <a name="create-script"></a>Step 2: Create a script for IP address discovery

In this step you create an <span class="caps">IP</span> detect script to broadcast the <span class="caps">IP</span> address of each node across the cluster. Each node in a <span class="caps">DCOS</span> cluster has a unique <span class="caps">IP</span> address that is used to communicate between nodes in the cluster. The <span class="caps">IP</span> detect script prints the unique IPv4 address of a node to <span class="caps">STDOUT</span> each time <span class="caps">DCOS</span> is started on the node.

**Important:** The <span class="caps">IP</span> address of a node must not change after <span class="caps">DCOS</span> is installed on the node. For example, the <span class="caps">IP</span> address must not change when a node is rebooted or if the <span class="caps">DHCP</span> lease is renewed. If the <span class="caps">IP</span> address of a node does change, the node must be [wiped and reinstalled][1].

1.  Create a directory named `dcos/genconf` on your workstation.

2.  Create an <span class="caps">IP</span> detection script for your environment and save as `genconf/ip-detect`.

### Examples {#examples}

*   #### Query an authority {#query-an-authority}
    
    Here is another example using the <span class="caps">AWS</span> Metadata service to get the <span class="caps">IP</span> address:
    
        #!/bin/sh
        # Example ip-detect script using an external authority
        # Uses the AWS Metadata Service to get the node's internal
        # ipv4 address
        curl -fsSL http://169.254.169.254/latest/meta-data/local-ipv4
        

*   #### Use the <span class="caps">IP</span> address of an existing interface {#use-the-ip-address-of-an-existing-interface}
    
    This method discovers the <span class="caps">IP</span> address of a particular interface of the node.
    
    If you have multiple generations of hardware with different internals, the interface names can change between hosts. The <span class="caps">IP</span> detection script must account for the interface name changes. The example script could also be confused if you attach multiple <span class="caps">IP</span> addresses to a single interface, or do complex Linux networking, etc.
    
        #!/usr/bin/env bash
        set -o nounset -o errexit
        export PATH=/usr/sbin:/usr/bin:$PATH
        echo $(ip addr show eth0 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1)
        

*   #### Use the network route to the Mesos master {#use-the-network-route-to-the-mesos-master}
    
    This method uses the route to a Mesos master to find the source <span class="caps">IP</span> address to then communicate with that node.
    
    In this example, we assume that the Mesos master has an <span class="caps">IP</span> address of `192.168.1.1`. You can use any language for this script. Your Shebang line must be pointed at the correct environment for the language used and the output must be the correct <span class="caps">IP</span> address.
    
        #!/usr/bin/env bash
        set -o nounset -o errexit
        
        MASTER_IP=172.28.128.3
        
        echo $(/usr/sbin/ip route show to match 172.28.128.3 | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | tail -1)
        

* * *

# <a name="config-json"></a>Step 3: Configure your cluster

In this step you create a <span class="caps">JSON</span> configuration file that is customized for your environment. <span class="caps">DCOS</span> uses this configuration file during installation to generate your cluster installation files.

**Important:** This step is critical. Do not install <span class="caps">DCOS</span> until you have created this file.

Create a <span class="caps">JSON</span> configuration file and save as `config.json`. For examples and a complete description of the available <span class="caps">JSON</span> configuration parameters, see [JSON config file options][2].

Here is an example configuration, where the cluster name is `fs-example`, the number of Mesos masters is 3, the storage system for configuring and orchestrating Zookeeper with Exhibitor is a shared file system, :

    {
        "cluster_name": "fs-example",
        "num_masters": 3,
        "exhibitor_storage_backend": "shared_filesystem",
        "exhibitor_fs_config_dir": "/shared-mount",
        "repository_url":"file:///tmp/dcos",
        "bootstrap_url":"file:///tmp/dcos",
        "resolvers": "["10.10.5.1", "10.10.6.1"]",
        "master_lb": "10.10.20.1",
        "roles": "slave_public",
        "weights": "slave_public=1"
    }
    

* * *

# <a name="install-bash"></a>Step 4: Configure and install <span class="caps">DCOS</span> {#a-nameinstall-bashastep-4-configure-and-install-dcos}

In this step you create a custom <span class="caps">DCOS</span> build file on your workstation and then install <span class="caps">DCOS</span> onto your cluster.

**Workstation prerequisites:**

*   **rsync utility** The <a href="https://rsync.samba.org/" target="_blank">rsync utility</a> is used to distribute <span class="caps">DCOS</span> installation files to your cluster. 
*   **Docker** Docker must be installed on your workstation. If you are using <span class="caps">RHEL7</span>, Docker must be installed by using a subscription channel. For more information, see <a href="https://access.redhat.com/articles/881893" target="_blank">Docker Formatted Container Images on Red Hat Systems</a>.

1.  Download and save the DC/OS setup file, `dcos_generate_config.sh`, to the `dcos` directory on your workstation. This file is used to create your customized DC/OS build file.
    
    **Important:** Contact your sales representative or <sales@mesosphere.io> to obtain the DC/OS setup file.

2.  Run the <span class="caps">DCOS</span> setup script with your [`ip-detect.sh`][3] and [`config.json`][4] files as arguments. The setup script uses the generic <span class="caps">DCOS</span> install files in the Docker container to create customized <span class="caps">DCOS</span> build files for your cluster. The build files are output to `./genconf/serve/`.
    
        sudo bash setup_dcos.sh --config=config.json --ip-detect-script=ip-detect.sh
        
    
    **Tip:** The installation Docker container is not used again after this step.

3.  Create a text file file that includes each of your master and agent nodes and save as `nodes.txt`. For example:
    
        10.0.0.1
        10.0.0.2
        10.0.0.3
        10.0.0.4
        10.0.0.5
        

4.  Use the rsync utility to copy the customized <span class="caps">DCOS</span> build files to each of your cluster nodes. The following command copies the <span class="caps">DCOS</span> build files from `genconf/serve/` to a file location `/tmp/dcos/` on each of your nodes, as specified in `nodes.txt`.
    
        for ip in $(cat nodes.txt); do
          rsync -avhP genconf/serve/* centos@$ip:/tmp/dcos
        done
        
    
    **Important:** The installation will fail if the file locations do not match the values as specified in your <span class="caps">JSON</span> configuration file.

5.  <span class="caps">SSH</span> into each master node and run this install command from the `dcos-setup` directory. This command installs <span class="caps">DCOS</span> into each master node using your custom build file.
    
        ssh MASTERS "cd /tmp/dcos; sudo bash dcos_install.sh master"
        
    
    **Tip:** Run this command on your master nodes one after another. Although there is no actual harm to your cluster, <span class="caps">DCOS</span> may issue error messages until all of your master nodes are configured.

6.  <span class="caps">SSH</span> into each agent node and run this command from the `dcos-setup` directory. This command installs <span class="caps">DCOS</span> into each agent node using your custom build file.
    
        ssh SLAVES "cd /tmp/dcos; sudo bash dcos_install.sh slave"
        

7.  Monitor Exhibitor and wait for your masters to converge at http://`<load-balanced-ip>`:8181/exhibitor/v1/ui/index.html.
    
    **Tip:** This process can take about 10 minutes. During this time you will see the Master nodes become visible on the Exhibitor consoles and come online, eventually showing a green light.
    
    When the status icons are green, you can access the <span class="caps">DCOS</span> web interface.
    
    ![ZooKeeper status](chef-zk-status.png)

8.  Launch the <span class="caps">DCOS</span> web interface at: `http://`< load-balanced-ip >`/`:
    
    ![UI dashboard](dashboardsmall.png)

 [1]: /cleanup/
 [2]: /configuration-parameters-1-2/
 [3]: #create-script
 [4]: #config-json